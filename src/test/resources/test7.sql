SELECT sum(table_1616047570537.column_3d4f4ea9cb) column_3d4f4ea9cb_sum,
       CAST(
               (
                       dateDiff(
                               'week',
                               toDate('1970-01-07'),
                               parseDateTimeBestEffort(table_1616047570537.column_aaf3923bfc)
                           ) + 1
                   ) AS varchar
           )                                      column_aaf3923bfc_biz_week,
       table_1616047570537.column_62ff4b9ddc      column_62ff4b9ddc,
       sum(table_1616047570537.column_e69a047246) column_e69a047246_sum,
       sum(table_1616047570537.column_f9b00d33a5) column_f9b00d33a5_sum,
       table_1616047570537.column_cffaffee50      column_cffaffee50
FROM (
         SELECT `column_aaf3923bfc`,
                `column_d95bf23a21`,
                `column_62ff4b9ddc`,
                `column_7149855732`,
                `column_2b5922f1b9`,
                `column_2e8fc54033`,
                `column_90bf7fa03a`,
                `column_d3046d8642`,
                `column_1da06deb49`,
                `column_a9bc447b45`,
                `column_a4aa7564d1`,
                `column_15a68622d8`,
                `column_79928543ac`,
                `column_fc9a035682`,
                `column_59ea9c2d70`,
                `column_0ee1dc1f94`,
                `column_c2bac0c165`,
                `column_cb3055691d`,
                `column_19da4eaafd`,
                `column_017eb08fdc`,
                `column_663cf97ac2`,
                `column_12546c6c98`,
                `column_071d55dbe6`,
                `column_946d59f53e`,
                `column_b57a44e55f`,
                `column_175a5793d7`,
                `column_014836abf8`,
                `column_319b72d6e1`,
                `column_92b81dcbcc`,
                `column_39911a153e`,
                `column_bfbf0a542a`,
                `column_e080d7acf1`,
                `column_a43c423869`,
                `column_8906a32fbc`,
                `column_a46ae23e51`,
                `column_1520582f36`,
                `column_dab9818eeb`,
                `column_8e5507e350`,
                `column_04b0ece32e`,
                `column_5d2aa7031f`,
                `column_00bfa3ef8c`,
                `column_cffaffee50`,
                `column_fb97affc20`,
                `column_f73d840b0c`,
                `column_d88fa3a872`,
                `column_f443e24c9c`,
                `column_eb923f0300`,
                `column_9dbff83cb5`,
                `column_09670bfa81`,
                `column_68d810fbd9`,
                `column_0a06615e2b`,
                `column_e9e5da848a`,
                `column_aee1fd0e54`,
                `column_61dcef6501`,
                `column_9497310f13`,
                `column_c344af9187`,
                `column_f0b1c7dea0`,
                `column_eff537958c`,
                `column_1c90a6dfa6`,
                `column_8b298fa20e`,
                `column_977b6c209f`,
                `column_db40f19aec`,
                `column_1373657a04`,
                `column_fda8f15afd`,
                `column_0a462ab116`,
                `column_fc240c00e1`,
                `column_71140bd9ef`,
                `column_b2be664246`,
                `column_048543f146`,
                `column_4c50c2cda9`,
                `column_6d46474edb`,
                `column_d8156a2214`,
                `column_2cf02441b3`,
                `column_8c6a04055e`,
                `column_f29f31da62`,
                `column_6f38da3d37`,
                `column_f873802179`,
                `column_83095a686f`,
                `column_7b0729c9da`,
                `column_1d955d2a52`,
                `column_618a7b1c49`,
                `column_a85893553e`,
                `column_643677a483`,
                `column_a4189429ed`,
                `column_5ae0ee6ce8`,
                `column_5074618dd8`,
                `column_9d9340bcc8`,
                `column_0f37378db6`,
                `column_e5f8b4c1a5`,
                `column_42ce097825`,
                `column_17693a8309`,
                `column_827d2ea0a4`,
                `column_f2926dd67c`,
                `column_1e21dce6e7`,
                `column_e806f0e91f`,
                `column_41da119efc`,
                `column_22dc6f7355`,
                `column_c18a73bba2`,
                `column_b23af84ef1`,
                `column_c589e2c5f8`,
                `column_087676cb0c`,
                `column_debea4beae`,
                `column_3d4f4ea9cb`,
                `column_e69a047246`,
                `column_f9b00d33a5`,
                `column_34e6e10492`,
                `column_a3f857c246`,
                `column_1fc89763e7`,
                `column_e902c502a5`,
                `column_33be5b6fbd`,
                `column_8c4676f3b2`,
                `column_61fe44a9e4`,
                `column_5819987c8e`,
                `column_49e8f6b6f3`,
                `column_5b7b810fe9`,
                `column_f9d08e5a52`,
                `column_02cc2f9780`,
                `column_84988da666`,
                `column_e697a3f0f9`,
                `column_f412d46551`,
                `column_aef7fc3075`,
                `column_e0a7b45919`,
                `column_e9ad7d9af1`,
                `column_5867121a01`,
                `column_a95611272c`,
                `column_18bf6ecb66`,
                `column_ce4daa9adf`,
                `column_df60e140ac`,
                `column_7e07226697`,
                `column_7ebc0fe5a1`,
                `column_f562751546`,
                `column_0724b28514`,
                `column_f25a484b82`,
                `column_80d5ccfe66`,
                `column_fde5e4c5fe`,
                `column_50931d1903`,
                `column_d096da465a`,
                `column_ab37f30e56`,
                `column_3ec32ca8d4`,
                `column_8fa1c65425`,
                `column_ed73fe86fc`,
                `column_b05f706a8c`,
                `column_28078625a8`,
                `column_5cf6686f66`,
                `column_eed9cc8364`,
                `column_94798f2886`,
                `column_23f5736c91`,
                `column_60edb214d0`,
                `column_69c01c53f7`,
                `column_4196b0999f`,
                `column_b80d019444`,
                `column_0907823bb5`
         FROM (
                  SELECT `dt`                          AS column_aaf3923bfc,
                         `activity_id`                 AS column_d95bf23a21,
                         `actual_pay_time`             AS column_62ff4b9ddc,
                         `addr`                        AS column_7149855732,
                         `addr_detail`                 AS column_2b5922f1b9,
                         `aft_type_name`               AS column_2e8fc54033,
                         `after_sale_order_id`         AS column_90bf7fa03a,
                         `after_sale_type_id`          AS column_d3046d8642,
                         `bd_name`                     AS column_1da06deb49,
                         `bd_phone`                    AS column_a9bc447b45,
                         `bdm_name`                    AS column_a4aa7564d1,
                         `bdm_phone`                   AS column_15a68622d8,
                         `biz_id`                      AS column_79928543ac,
                         `biz_type_name`               AS column_fc9a035682,
                         `brand`                       AS column_59ea9c2d70,
                         `category_id`                 AS column_0ee1dc1f94,
                         `category_name`               AS column_c2bac0c165,
                         `check_time`                  AS column_cb3055691d,
                         `company_name`                AS column_19da4eaafd,
                         `confirm_receipt_time`        AS column_017eb08fdc,
                         `coordinate`                  AS column_663cf97ac2,
                         `create_time`                 AS column_12546c6c98,
                         `custom_tag`                  AS column_071d55dbe6,
                         `custom_tag_name`             AS column_946d59f53e,
                         `develop_channel_name`        AS column_b57a44e55f,
                         `discount_details`            AS column_175a5793d7,
                         `expect_send_time`            AS column_014836abf8,
                         `field1`                      AS column_319b72d6e1,
                         `goods_id`                    AS column_92b81dcbcc,
                         `goods_name`                  AS column_39911a153e,
                         `goods_type_name`             AS column_bfbf0a542a,
                         `group_id`                    AS column_e080d7acf1,
                         `has_store_name`              AS column_a43c423869,
                         `inviter_id`                  AS column_8906a32fbc,
                         `inviter_phone`               AS column_a46ae23e51,
                         `inviter_type`                AS column_1520582f36,
                         `inviter_type_name`           AS column_dab9818eeb,
                         `inviter_zh_name`             AS column_8e5507e350,
                         `is_first_order_user`         AS column_04b0ece32e,
                         `latitude`                    AS column_5d2aa7031f,
                         `lead_city_id`                AS column_00bfa3ef8c,
                         `lead_city_name`              AS column_cffaffee50,
                         `lead_county_id`              AS column_fb97affc20,
                         `lead_county_name`            AS column_f73d840b0c,
                         `lead_pro_id`                 AS column_d88fa3a872,
                         `lead_pro_name`               AS column_f443e24c9c,
                         `leader_create_time`          AS column_eb923f0300,
                         `leader_id`                   AS column_9dbff83cb5,
                         `leader_name`                 AS column_09670bfa81,
                         `leader_phone`                AS column_68d810fbd9,
                         `leader_self_uid`             AS column_0a06615e2b,
                         `leader_sex`                  AS column_e9e5da848a,
                         `leader_uid`                  AS column_aee1fd0e54,
                         `leader_wx_open_id`           AS column_61dcef6501,
                         `level_1_id`                  AS column_9497310f13,
                         `level_1_name`                AS column_c344af9187,
                         `level_2_id`                  AS column_f0b1c7dea0,
                         `level_2_name`                AS column_eff537958c,
                         `level_3_id`                  AS column_1c90a6dfa6,
                         `level_3_name`                AS column_8b298fa20e,
                         `longitude`                   AS column_977b6c209f,
                         `odr_city_id`                 AS column_db40f19aec,
                         `odr_city_name`               AS column_1373657a04,
                         `order_id`                    AS column_fda8f15afd,
                         `order_label`                 AS column_0a462ab116,
                         `order_type_name`             AS column_fc240c00e1,
                         `origin`                      AS column_71140bd9ef,
                         `out_trade_id`                AS column_b2be664246,
                         `overtime_close_time`         AS column_048543f146,
                         `pay_finish_time`             AS column_4c50c2cda9,
                         `phone`                       AS column_6d46474edb,
                         `pic_url`                     AS column_d8156a2214,
                         `production_time`             AS column_2cf02441b3,
                         `reason_type_name`            AS column_8c6a04055e,
                         `recomment_phone`             AS column_f29f31da62,
                         `recomment_zh_name`           AS column_6f38da3d37,
                         `refrigeration_type_name`     AS column_f873802179,
                         `remark`                      AS column_83095a686f,
                         `sku_id`                      AS column_7b0729c9da,
                         `source_name`                 AS column_1d955d2a52,
                         `specification`               AS column_618a7b1c49,
                         `stat_time`                   AS column_a85893553e,
                         `status_name`                 AS column_643677a483,
                         `stock_id`                    AS column_a4189429ed,
                         `stock_name`                  AS column_5ae0ee6ce8,
                         `store_type_name`             AS column_5074618dd8,
                         `storehouse_id`               AS column_9d9340bcc8,
                         `sub_order_id`                AS column_0f37378db6,
                         `supplier_addr`               AS column_e5f8b4c1a5,
                         `supplier_code`               AS column_42ce097825,
                         `supplier_money`              AS column_17693a8309,
                         `supplier_province_id`        AS column_827d2ea0a4,
                         `supplier_type_name`          AS column_f2926dd67c,
                         `unit`                        AS column_1e21dce6e7,
                         `update_time`                 AS column_e806f0e91f,
                         `user_id`                     AS column_41da119efc,
                         `user_phone`                  AS column_22dc6f7355,
                         `user_sex`                    AS column_c18a73bba2,
                         `warehouse_addr`              AS column_b23af84ef1,
                         `warehouse_code`              AS column_c589e2c5f8,
                         `warehouse_name`              AS column_087676cb0c,
                         `wx_open_id`                  AS column_debea4beae,
                         `actual_deduct_commision_amt` AS column_3d4f4ea9cb,
                         `actual_goods_cnt`            AS column_e69a047246,
                         `after_sale_amt`              AS column_f9b00d33a5,
                         `after_sale_is_td_aft_apply`  AS column_34e6e10492,
                         `after_sale_is_td_aft_pass`   AS column_a3f857c246,
                         `b_subsidy_amount`            AS column_1fc89763e7,
                         `biz_type`                    AS column_e902c502a5,
                         `can_invite`                  AS column_33be5b6fbd,
                         `commission_amt`              AS column_8c4676f3b2,
                         `cost_price_amt`              AS column_61fe44a9e4,
                         `develop_channel`             AS column_5819987c8e,
                         `evaluated`                   AS column_49e8f6b6f3,
                         `field2`                      AS column_5b7b810fe9,
                         `final_payment_amt`           AS column_f9d08e5a52,
                         `goods_cnt`                   AS column_02cc2f9780,
                         `goods_type`                  AS column_84988da666,
                         `is_fresh`                    AS column_e697a3f0f9,
                         `is_fruits`                   AS column_f412d46551,
                         `is_new_leader`               AS column_aef7fc3075,
                         `is_recruits`                 AS column_e0a7b45919,
                         `is_td_cancel`                AS column_e9ad7d9af1,
                         `is_td_overtime`              AS column_5867121a01,
                         `is_td_pay`                   AS column_a95611272c,
                         `is_td_user_receive`          AS column_18bf6ecb66,
                         `is_td_valid_pay`             AS column_ce4daa9adf,
                         `is_vgtble`                   AS column_df60e140ac,
                         `leader_age`                  AS column_7e07226697,
                         `leader_ratio`                AS column_7ebc0fe5a1,
                         `line_price`                  AS column_f562751546,
                         `minimum_commission_amt`      AS column_0724b28514,
                         `number_perbox`               AS column_f25a484b82,
                         `order_type`                  AS column_80d5ccfe66,
                         `pay_amount_amt`              AS column_fde5e4c5fe,
                         `pre_sale_amt`                AS column_50931d1903,
                         `price`                       AS column_d096da465a,
                         `price_amt`                   AS column_ab37f30e56,
                         `reason_type`                 AS column_3ec32ca8d4,
                         `refrigeration_type`          AS column_8fa1c65425,
                         `sale_cnt`                    AS column_ed73fe86fc,
                         `source`                      AS column_b05f706a8c,
                         `status`                      AS column_28078625a8,
                         `store_type`                  AS column_5cf6686f66,
                         `supplier_type`               AS column_eed9cc8364,
                         `total_price_amt`             AS column_94798f2886,
                         `user_active_coupons_amt`     AS column_23f5736c91,
                         `user_after_coupons_amt`      AS column_60edb214d0,
                         `user_coupons_amt`            AS column_69c01c53f7,
                         `user_discount_amt`           AS column_4196b0999f,
                         `user_subsidy_amt`            AS column_b80d019444,
                         `warehouse_type`              AS column_0907823bb5
                  FROM test_db.test_table
                  WHERE (
                            dt BETWEEN '2020-12-01'
                                AND '2020-12-20'
                            )
              ) tmp_0
     ) table_1616047570537
WHERE (
              (
                      (
                          table_1616047570537.column_aaf3923bfc BETWEEN '2020-12-01'
                              AND '2021-03-17'
                          )
                      OR (
                              (
                                  table_1616047570537.column_aaf3923bfc BETWEEN '2019-11-26'
                                      AND '2020-03-25'
                                  )
                              OR (
                                  table_1616047570537.column_aaf3923bfc BETWEEN '2020-11-17'
                                      AND '2021-03-17'
                                  )
                          )
                  )
              AND (
                  table_1616047570537.column_cffaffee50 IN ('广州市', '深圳市', '珠海市', '杭州市')
                  )
          )
GROUP BY CAST(
                 (
                         dateDiff(
                                 'week',
                                 toDate('1970-01-07'),
                                 parseDateTimeBestEffort(table_1616047570537.column_aaf3923bfc)
                             ) + 1
                     ) AS varchar
             ),
         table_1616047570537.column_cffaffee50,
         table_1616047570537.column_62ff4b9ddc